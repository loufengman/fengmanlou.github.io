<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="d3-_DlOvmPV3hopvTNDpxNcXZ90QHXP96UNQveLbUaI">














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="西北玄天一片云">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="西北玄天一片云">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="西北玄天一片云">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>西北玄天一片云</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">西北玄天一片云</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Ctl+C, Ctl+V</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tag"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-about"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/28/Redis容量评估/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西北玄天一片云">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/28/Redis容量评估/" itemprop="url">Redis容量评估</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-28T18:21:00+08:00">
                2020-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/系统设计/" itemprop="url" rel="index">
                    <span itemprop="name">系统设计</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/系统设计/容量预估/" itemprop="url" rel="index">
                    <span itemprop="name">容量预估</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>存储容量预估系统设计最重要的项之一。精准的容量预估，可以帮助我们选择最合适存储软件。</p>
<p>本文主要来介绍下Redis几种常用的数据结构，以及内存占用大小。</p>
<h2 id="字符串（SDS）"><a href="#字符串（SDS）" class="headerlink" title="字符串（SDS）"></a>字符串（SDS）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//SDS的定义如下（sds.h/sdshdr）：</span><br><span class="line">struct sdshdr &#123;</span><br><span class="line">    int len;         // 记录buf数组中已使用字节的数量</span><br><span class="line">    int free;        // 记录buf数组中未使用字节的数量</span><br><span class="line">    char buf[];      // 字节数组，用于保存实际字符串</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="red">字符串长度不能超过512MB</font>。</p>
<p>下图展示了一个SDS实例：</p>
<p><img src="/2020/02/28/Redis容量评估/sds.png" alt></p>
<p>SDS实例中存储了字符串“Redis”， 该实例中free的值为5(表示未使用的字节为5)，len的值为5(表示已使用的字节为5)，加上字符数组末尾的”\0”，所以SDS实例占用的总字节数为:<br><font size="5" color="red"><code>(sizeof(int) * 2) + (5 + 5 + 1) = 19</code></font>，即<code>(len+free)+buf</code></p>
<h3 id="举例说明"><a href="#举例说明" class="headerlink" title="举例说明"></a>举例说明</h3><p>当key长度为 13，value长度为15，key个数为2000，根据上面总结的容量评估模型，容量预估值为 (32 + 16 + 32 + 32) * 2000 + 2048 * 8 = 240384</p>
<h3 id="生产实践"><a href="#生产实践" class="headerlink" title="生产实践"></a>生产实践</h3><p>用redis做商品缓存，key为商品id，value为商品信息。key大约占用30个字节，value大约占用1500个字节。<br>当缓存1百万商品时，容量预估值为(32 + 16 + 64 + 1536) * 1000000+ 1000000(预估) * 8 = 1656000000，约等于1.54G<br>总结：当value比较大时，占用的内存约等于value的大小*个数</p>
<h2 id="双向链表（List）"><a href="#双向链表（List）" class="headerlink" title="双向链表（List）"></a>双向链表（List）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//每个链表节点使用一个listNode结构来表示，具体定义如(adlist.h/listNode)：</span><br><span class="line">typedef struct listNode &#123;</span><br><span class="line">    struct listNode *prev;              // 前置节点</span><br><span class="line">    struct listNode *next;              // 后置节点</span><br><span class="line">    void *value;                        // 节点的值</span><br><span class="line">&#125; listNode;</span><br><span class="line"></span><br><span class="line">//redis另外还使用了list结构来管理链表，以方便操作，具体定义如下(adlist.h/list)：</span><br><span class="line"></span><br><span class="line">typedef struct list &#123;</span><br><span class="line">    listNode *head;                             // 表头节点</span><br><span class="line">    listNode *tail;                             // 表尾结点</span><br><span class="line">    void *(*dup)(void *ptr);                    // 节点值复制函数</span><br><span class="line">    void (*free)(void *ptr);                    // 节点值释放函数</span><br><span class="line">    int (*match)(void *ptr, void *key);         // 节点值对比函数</span><br><span class="line">    unsigned int len;                           // 链表所包含的节点数量</span><br><span class="line">&#125; list;</span><br></pre></td></tr></table></figure>

<h2 id="有序集合（ZSET）"><a href="#有序集合（ZSET）" class="headerlink" title="有序集合（ZSET）"></a>有序集合（ZSET）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/* ZSETs use a specialized version of Skiplists */</span><br><span class="line">typedef struct zskiplistNode &#123;</span><br><span class="line">    sds ele;</span><br><span class="line">    double score;</span><br><span class="line">    struct zskiplistNode *backward;</span><br><span class="line">    struct zskiplistLevel &#123;</span><br><span class="line">        struct zskiplistNode *forward;</span><br><span class="line">        unsigned long span;</span><br><span class="line">    &#125; level[];</span><br><span class="line">&#125; zskiplistNode;</span><br><span class="line"></span><br><span class="line">typedef struct zskiplist &#123;</span><br><span class="line">    struct zskiplistNode *header, *tail;</span><br><span class="line">    unsigned long length;</span><br><span class="line">    int level;</span><br><span class="line">&#125; zskiplist;</span><br><span class="line"></span><br><span class="line">typedef struct zset &#123;</span><br><span class="line">    dict *dict;</span><br><span class="line">    zskiplist *zsl;</span><br><span class="line">&#125; zset;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>zskiplistNode结构占用的总字节数为：24 + 16 * n，n为level数组的大小。</p>
</blockquote>
<blockquote>
<p>zskiplist结构则用于保存跳跃表节点的相关信息，header和tail分别指向跳跃表的表头和表尾节点，length记录节点总数量，level记录跳跃表中层高最大的那个节点的层数量。zskiplist结构占用的总字节数为32。</p>
</blockquote>
<h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">typedef struct dictEntry &#123;</span><br><span class="line">    void *key;</span><br><span class="line">    union &#123;</span><br><span class="line">        void *val;</span><br><span class="line">        uint64_t u64;</span><br><span class="line">        int64_t s64;</span><br><span class="line">        double d;</span><br><span class="line">    &#125; v;</span><br><span class="line">    struct dictEntry *next;</span><br><span class="line">&#125; dictEntry;</span><br><span class="line"></span><br><span class="line">typedef struct dictType &#123;</span><br><span class="line">    uint64_t (*hashFunction)(const void *key);</span><br><span class="line">    void *(*keyDup)(void *privdata, const void *key);</span><br><span class="line">    void *(*valDup)(void *privdata, const void *obj);</span><br><span class="line">    int (*keyCompare)(void *privdata, const void *key1, const void *key2);</span><br><span class="line">    void (*keyDestructor)(void *privdata, void *key);</span><br><span class="line">    void (*valDestructor)(void *privdata, void *obj);</span><br><span class="line">&#125; dictType;</span><br><span class="line"></span><br><span class="line">/* This is our hash table structure. Every dictionary has two of this as we</span><br><span class="line"> * implement incremental rehashing, for the old to the new table. */</span><br><span class="line">typedef struct dictht &#123;</span><br><span class="line">    dictEntry **table;</span><br><span class="line">    unsigned long size;</span><br><span class="line">    unsigned long sizemask;</span><br><span class="line">    unsigned long used;</span><br><span class="line">&#125; dictht;</span><br><span class="line"></span><br><span class="line">typedef struct dict &#123;</span><br><span class="line">    dictType *type;</span><br><span class="line">    void *privdata;</span><br><span class="line">    dictht ht[2];</span><br><span class="line">    long rehashidx; /* rehashing not in progress if rehashidx == -1 */</span><br><span class="line">    unsigned long iterators; /* number of iterators currently running */</span><br><span class="line">&#125; dict;</span><br></pre></td></tr></table></figure>

<p>一个Hash存储结构最终会产生以下几个消耗内存的结构：</p>
<ul>
<li>1个SDS结构，用作key字符串，占9个字节(free4个字节+len4个字节+字符串末尾”\0”1个字节)；</li>
<li>1个dictEntry结构，24字节，负责保存当前的哈希对象；</li>
<li>1个redisObject结构，16字节，指向当前key下属的dict结构；</li>
<li>1个dict结构，88字节，负责保存哈希对象的键值对；</li>
<li>n个dictEntry结构，24*n字节，负责保存具体的field和value，n等于field个数；</li>
<li>n个redisObject结构，16*n字节，用作field对象；</li>
<li>n个redisObject结构，16*n字节，用作value对象；</li>
<li>n个SDS结构，（field长度＋9）*n字节，用作field字符串；</li>
<li>n个SDS结构，（value长度＋9）*n字节，用作value字符串；</li>
</ul>
<p>因为hash类型内部有两个dict结构，所以最终会有产生两种rehash，一种rehash基准是field个数，另一种rehash基准是key个数，结合jemalloc内存分配规则，hash类型的容量评估模型为：</p>
<blockquote>
<p>总内存消耗 = [key_SDS大小 + redisObject大小 + dictEntry大小 + dict大小 +(redisObject大小 * 2 + field_SDS大小 + val_SDS大小 + dictEntry大小) * field个数 + field_bucket个数 * 指针大小] * key个数 + key_bucket个数 * 指针大小</p>
</blockquote>
<p>【换算】<br>总内存消耗 = [ key_SDS大小 + 16 + 24 + 88 + (16 * 2 + field_SDS大小 + val_SDS大小 + 24) * field个数 + field_bucket个数 * 8] * key个数 + key_bucket个数 * 8<br>总内存消耗 =[128+ key_SDS大小 +(56 + field_SDS大小 + val_SDS大小 ) * field个数 + field_bucket个数 * 8] * key个数 + key_bucket个数 * 8</p>
<h2 id="集合（SET）"><a href="#集合（SET）" class="headerlink" title="集合（SET）"></a>集合（SET）</h2><p>SET的实现其实就是value为null的hash表</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://blog.csdn.net/u011983531/article/details/79598671" target="_blank" rel="noopener">Redis容量预估</a></li>
<li><a href="http://www.cnblogs.com/kismetv/p/8654978.html#t34" target="_blank" rel="noopener">深入学习Redis（1）：Redis内存模型</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/28/微服务与SOA架构对比/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西北玄天一片云">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/28/微服务与SOA架构对比/" itemprop="url">微服务与SOA架构对比</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-28T13:34:00+08:00">
                2020-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/架构/" itemprop="url" rel="index">
                    <span itemprop="name">架构</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/架构/微服务/" itemprop="url" rel="index">
                    <span itemprop="name">微服务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>面向服务架构（SOA， Service-oriented architecture）已经存在有些年头了，这是一种用于设计软件的伟大原则。在SOA中，所有组件都是独立自主的，并能为其他组件提供服务。</p>
<p><img src="/2020/02/28/微服务与SOA架构对比/%E5%AF%B9%E6%AF%94%E8%A1%A8%E6%A0%BC.png" alt></p>
<p><img src="/2020/02/28/微服务与SOA架构对比/%E5%AF%B9%E6%AF%94%E5%9B%BE.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">下面进一步解释上表所述的不同之处：</span><br><span class="line"></span><br><span class="line">开发方面 - 在这两种体系结构中，可以使用不同的编程语言和工具开发服务，从而将技术多样性带入开发团队。开发可以在多个团队中组织，但是在SOA中，每个团队都需要了解常见的通信机制。另一方面，使用微服务，服务可以独立于其他服务运行和部署。因此，频繁部署新版本的微服务或独立扩展服务会更容易。您可以在这里进一步阅读有关微服务的这些好处。</span><br><span class="line"></span><br><span class="line">“上下文边界” - SOA鼓励组件的共享，而微服务尝试通过“上下文边界”来最小化共享。上下文边界是指以最小的依赖关系将组件及其数据耦合为单个单元。由于SOA依靠多个服务来完成业务请求，构建在SOA上的系统可能比微服务要慢。</span><br><span class="line"></span><br><span class="line">通信 - 在SOA中，ESB可能成为影响整个系统的单一故障点。由于每个服务都通过ESB进行通信，如果其中一个服务变慢，可能会阻塞ESB并请求该服务。另一方面，微服务在容错方面要好得多。例如，如果一个微服务存在内存错误，那么只有该微服务会受到影响。所有其他微服务将继续定期处理请求。</span><br><span class="line"></span><br><span class="line">互操作性 - SOA通过消息中间件组件促进了多种异构协议的使用。微服务试图通过减少集成选择的数量来简化架构模式。因此，如果您想要在异构环境中使用不同协议来集成多个系统，则需要考虑SOA。如果您的所有服务都可以通过相同的远程访问协议访问，那么微服务对您来说是一个更好的选择。</span><br><span class="line"></span><br><span class="line">大小Size - 最后一点但并非最不重要的一点，SOA和微服务的主要区别在于规模和范围。微服务架构中的前缀“微”是指内部组件的粒度，意味着它们必须比SOA架构的服务往往要小得多。微服务中的服务组件通常有一个单一的目的，他们做得很好。另一方面，在SOA服务中通​​常包含更多的业务功能，并且通常将它们实现为完整的子系统。</span><br></pre></td></tr></table></figure>

<p>典型微服务架构图，当然还要配合服务发现、服务治理、服务监控</p>
<p><img src="/2020/02/28/微服务与SOA架构对比/%E5%85%B8%E5%9E%8B%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg" alt></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://www.cnblogs.com/jiangzhaowei/p/9168837.html" target="_blank" rel="noopener">微服务架构 vs. SOA架构</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/28/长连接与短连接/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西北玄天一片云">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/28/长连接与短连接/" itemprop="url">长连接与短连接</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-28T12:14:00+08:00">
                2020-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/HTTP/" itemprop="url" rel="index">
                    <span itemprop="name">HTTP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>短连接、keepalive、长连接，相信有很多人分不清楚这三个概念。包括本人在写下这句话的时候。</p>
<h2 id="短连接"><a href="#短连接" class="headerlink" title="短连接"></a>短连接</h2><p>短连接可能是大部分人最长接触到的，也比较容易理解：</p>
<ol>
<li>建立连接</li>
<li>数据交互</li>
<li>关闭连接</li>
</ol>
<p>短连接多用于操作频繁，点对点的通讯，而且连接数不能太多的情况。每个 TCP 连接的建立都需要三次握手，每个 TCP 连接的断开要四次挥手。适用于并发量大，但是每个用户又不需频繁操作的情况。</p>
<p>但是在用户需要频繁操作的业务场景下(如新用户注册，网购提交订单等)，频繁的使用短连接则会使性能时延产生叠加。</p>
<h2 id="keepalive"><a href="#keepalive" class="headerlink" title="keepalive"></a>keepalive</h2><p>通过Http1.1默认开启Keep Alive（<a href="https://loufengman.github.io/2020/02/25/http%E5%8D%8F%E8%AE%AE/" target="_blank" rel="noopener">http1.0 1.1 2.0</a>），我们可以让一条Http连接保持不被立即关闭。有些同学这时就疑惑了，是不是长连接就是Keep Alive呢？</p>
<blockquote>
<p>其实不是的。长连接我们也叫TCP长连接，它是架设在TCP协议上的，而上面说的Keep Alive是Http协议的内容，连协议都不同，两者自然不是一个东西。</p>
</blockquote>
<blockquote>
<p>开启了Keep Alive是Http连接，我们也称之为持久连接，和长连接并不同。感兴趣可参考此文：<a href="https://halfrost.com/advance_tcp/" target="_blank" rel="noopener">《TCP 进阶》</a>。</p>
</blockquote>
<h2 id="长连接"><a href="#长连接" class="headerlink" title="长连接"></a>长连接</h2><blockquote>
<p>长连接与持久连接本质上非常的相似，持久连接侧重于 HTTP 应用层，特指一次请求结束之后，服务器会在自己设置的 keepalivetimeout 时间到期后才关闭已经建立的连接。长连接则是 client 方与 server 方先建立连接，连接建立后不断开，然后再进行报文发送和接收，直到有一方主动关闭连接为止。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">长连接的适用场景也非常的广泛：</span><br><span class="line">监控系统：后台硬件热插拔、LED、温度、电压发生变化等；</span><br><span class="line">IM 应用：收发消息的操作；</span><br><span class="line">即时报价系统：例如股市行情 push 等；</span><br><span class="line">推送服务：各种 App 内置的 push 提醒服务；</span><br></pre></td></tr></table></figure>

<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://juejin.im/post/5c6234426fb9a049e7029555" target="_blank" rel="noopener">Android 架构之长连接技术</a></li>
<li><a href="https://halfrost.com/advance_tcp/" target="_blank" rel="noopener">《TCP 进阶》</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/28/分布式锁的实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西北玄天一片云">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/28/分布式锁的实现/" itemprop="url">分布式锁的实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-28T09:43:00+08:00">
                2020-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/系统设计/" itemprop="url" rel="index">
                    <span itemprop="name">系统设计</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/系统设计/分布式/" itemprop="url" rel="index">
                    <span itemprop="name">分布式</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在分布式环境中，经常遇到多台机器上的多个进程对同一数据的操作，如果这些进程不做互斥处理的话，往往会出现不符合预期的错误，比如商品超卖、红包超发、账号多扣款等。</p>
<p>多台机器上的进程的互斥，可以通过锁来达成。接下来我们介绍几种分布式锁的实现方式。</p>
<h2 id="方式一、Redis-setnx"><a href="#方式一、Redis-setnx" class="headerlink" title="方式一、Redis setnx"></a>方式一、Redis setnx</h2><p>这是比较常见的一种简单实现方式</p>
<p>我们先来看一下Redis setnx的文档介绍：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SETNX key value</span><br><span class="line"></span><br><span class="line">将 key 的值设为 value ，当且仅当 key 不存在。</span><br><span class="line"></span><br><span class="line">若给定的 key 已经存在，则 SETNX 不做任何动作。</span><br><span class="line"></span><br><span class="line">SETNX 是『SET if Not eXists』(如果不存在，则 SET)的简写。</span><br><span class="line"></span><br><span class="line">可用版本：</span><br><span class="line">&gt;= 1.0.0</span><br><span class="line">时间复杂度：</span><br><span class="line">O(1)</span><br><span class="line">返回值：</span><br><span class="line">设置成功，返回 1 。</span><br><span class="line">设置失败，返回 0 。</span><br></pre></td></tr></table></figure>

<p>带过期时间的分布式锁实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class DistributeLock &#123;</span><br><span class="line">	private $redis;</span><br><span class="line">	</span><br><span class="line">	public function __construct() &#123;</span><br><span class="line">		$this-&gt;redis = new Redis(); </span><br><span class="line">   		$this-&gt;redis-&gt;connect(&apos;127.0.0.1&apos;, 6379); </span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   /**</span><br><span class="line">   	 * @param $key string 锁的key</span><br><span class="line">   	 * @param $expire int 锁定的时长，单位秒</span><br><span class="line">   	 * @return bool true：锁定成功；false：锁定失败</span><br><span class="line">   	 */</span><br><span class="line">	function lock($key, $expire) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			if ($this-&gt;redis-&gt;setnx($key, 1) &#123;</span><br><span class="line">				$this-&gt;redis-&gt;expire($key, $expire);</span><br><span class="line">				return true;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (Exception $e) &#123;</span><br><span class="line">			$this-&gt;redis-&gt;del($key);</span><br><span class="line">		&#125;</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	function unlock($key) &#123;</span><br><span class="line">		$this-&gt;redis-&gt;del($key);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看似没问题，想一下这种情况，setnx成功之后，expire操作执行失败了，进程crash，则该key设置的锁永远得不到释放。</p>
<p>这种实现方式的问题在于，setnx与expire操作不是原子操作，存在单点故障时锁无法释放的问题。</p>
<h2 id="方式二、RedLock"><a href="#方式二、RedLock" class="headerlink" title="方式二、RedLock"></a>方式二、RedLock</h2><p>这是redis之父antirez提出的分布式锁实现方式。</p>
<p>Redlock获取锁的过程。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 获取开始时间</span><br><span class="line">2. 去各个节点获取锁</span><br><span class="line">3. 再次获取时间。</span><br><span class="line">4. 计算获取锁的时间，检查获取锁的时间是否小于获取锁的时间。</span><br><span class="line">5. 持有锁。</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/antirez/redlock-rb" target="_blank" rel="noopener">antirez版redlock-rb</a></p>
<p><a href="https://github.com/ronnylt/redlock-php" target="_blank" rel="noopener">PHP版redlock-php</a></p>
<p>Redlock获取锁的过程。</p>
<p><code>向各个节点发送del命令，删除锁</code>。</p>
<h3 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h3><pre><code>依赖于分布式机器时钟的同步。</code></pre><p>这个问题曾引起分布式专家martin与Redis之父Antirez之间的论战。参见参考文档。</p>
<p>Martin 对 RedLock的指控：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 分布式的锁具有一个自动释放的功能。锁的互斥性，只在过期时间之内有效，锁过期释放以后就会造成多个Client 持有锁。</span><br><span class="line"></span><br><span class="line">2. RedLock 整个系统是建立在，一个在实际系统无法保证的系统模型上的。在这个例子中就是系统假设时间是同步且可信的。</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/28/分布式锁的实现/unsafe-lock.png" alt></p>
<p>Martin对锁的改进，增加了token，实际是利用了CAS的乐观锁实现：</p>
<p><img src="/2020/02/28/分布式锁的实现/fencing-tokens.png" alt></p>
<p>最后，martin推荐Zookeeper实现分布式锁。</p>
<p>Antirez的回应：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">首先在实际的系统中，从两个方面来看：</span><br><span class="line"></span><br><span class="line">1. 系统暂停，网络延迟。</span><br><span class="line">2. 系统的时间发生阶跃。</span><br><span class="line">对于第一个问题。上文已经提到了，RedLock做了一些微小的工作，但是没办法完全避免。其他带有自动释放的分布式锁也没有办法。</span><br><span class="line"></span><br><span class="line">第二个问题，Martin认为系统时间的阶跃主要来自两个方面：</span><br><span class="line"></span><br><span class="line">1. 人为修改。</span><br><span class="line">2. 从NTP服务收到了一个跳跃时时钟更新。</span><br><span class="line"></span><br><span class="line">对于人为修改，能说啥呢？人要搞破坏没办法避免。</span><br><span class="line"></span><br><span class="line">NTP受到一个阶跃时钟更新，对于这个问题，需要通过运维来保证。需要将阶跃的时间更新到服务器的时候，应当采取小步快跑的方式。多次修改，每次更新时间尽量小。</span><br></pre></td></tr></table></figure>

<h2 id="方式三、基于ZooKeeper实现"><a href="#方式三、基于ZooKeeper实现" class="headerlink" title="方式三、基于ZooKeeper实现"></a>方式三、基于ZooKeeper实现</h2><p>原理分析：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 锁即Zookeeper上的一个节点</span><br><span class="line">2. 客户端A发起一个加锁请求，先会在你要加锁的node下搞一个临时顺序节点。</span><br><span class="line">3. 如果创建的几点序号是1，则获得锁</span><br><span class="line">4. 序号不是1，则监听上一个序号释放锁。</span><br><span class="line">5. 释放锁即删除临时节点。</span><br></pre></td></tr></table></figure>

<p>初始状态：<br><img src="/2020/02/28/分布式锁的实现/zk-node.png" alt></p>
<p>获取锁的流程<br><img src="/2020/02/28/分布式锁的实现/zk-lock.png" alt></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="http://doc.redisfans.com/string/setnx.html" target="_blank" rel="noopener">SETNX</a></li>
<li><a href="https://redis.io/commands/setnx" target="_blank" rel="noopener">SETNX key value</a></li>
<li><a href="https://github.com/ronnylt/redlock-php" target="_blank" rel="noopener">PHP版redlock-php</a></li>
<li><a href="https://www.jianshu.com/p/dc3175eefe65" target="_blank" rel="noopener">Redis RedLock 完美的分布式锁么？</a></li>
<li><a href="http://antirez.com/news/101" target="_blank" rel="noopener">Is Redlock Safe?</a></li>
<li><a href="http://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html" target="_blank" rel="noopener">Martin 和 antirez关于RedLock的论战</a></li>
<li><a href="https://juejin.im/post/5c01532ef265da61362232ed" target="_blank" rel="noopener">七张图彻底讲清楚ZooKeeper分布式锁的实现原理【石杉的架构笔记】</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/27/回溯算法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西北玄天一片云">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/27/回溯算法/" itemprop="url">回溯算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-27T19:35:00+08:00">
                2020-02-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/回溯算法/" itemprop="url" rel="index">
                    <span itemprop="name">回溯算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><p><a href="https://leetcode-cn.com/problems/permutations/" target="_blank" rel="noopener">全排列</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    private $list_path = [];</span><br><span class="line">    /**</span><br><span class="line">     * @param Integer[] $nums</span><br><span class="line">     * @return Integer[][]</span><br><span class="line">     */</span><br><span class="line">    function permute($nums) &#123;</span><br><span class="line">        if(count($nums) == 0) &#123;</span><br><span class="line">            return [];</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;backtrace($nums, 0);</span><br><span class="line">        return $this-&gt;list_path;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function backtrace($nums, $start) &#123;</span><br><span class="line">        if ($start == count($nums)) &#123;</span><br><span class="line">                $this-&gt;list_path[] = $nums;</span><br><span class="line">        &#125;</span><br><span class="line">        for($i=$start;$i&lt;count($nums);$i++) &#123;</span><br><span class="line">            $this-&gt;swap($nums[$start], $nums[$i]);</span><br><span class="line">            $this-&gt;backtrace($nums, $start+1);</span><br><span class="line">            $this-&gt;swap($nums[$start], $nums[$i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    function swap(&amp;$i, &amp;$j) &#123;</span><br><span class="line">        $t = $i;</span><br><span class="line">        $i = $j;</span><br><span class="line">        $j = $t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>##题目二<br><a href="https://leetcode-cn.com/problems/combination-sum/" target="_blank" rel="noopener">组合总数</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public $path = [];</span><br><span class="line">    public $sums = [];</span><br><span class="line">    /**</span><br><span class="line">     * @param Integer[] $candidates</span><br><span class="line">     * @param Integer $target</span><br><span class="line">     * @return Integer[][]</span><br><span class="line">     */</span><br><span class="line">    function combinationSum($candidates, $target) &#123;</span><br><span class="line">        $length = count($candidates);</span><br><span class="line">        if ($length == 0) &#123;</span><br><span class="line">            return [];</span><br><span class="line">        &#125;</span><br><span class="line">        sort($candidates);</span><br><span class="line">        $this-&gt;dfs($candidates, 0, $target);</span><br><span class="line">        return $this-&gt;sums;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function dfs($candidates, $start, $target) &#123;</span><br><span class="line">        if ($target == 0) &#123;</span><br><span class="line">            $this-&gt;sums[] = $this-&gt;path;</span><br><span class="line">        &#125;</span><br><span class="line">        for($i = $start;$i&lt;count($candidates) &amp;&amp; ($target-$candidates[$i]&gt;=0);$i++) &#123;</span><br><span class="line">            $this-&gt;path[] = $candidates[$i];</span><br><span class="line">            $this-&gt;dfs($candidates, $i, $target-$candidates[$i]);</span><br><span class="line">            array_pop($this-&gt;path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="题目三"><a href="#题目三" class="headerlink" title="题目三"></a>题目三</h2><p><a href="https://leetcode-cn.com/problems/letter-combinations-of-a-phone-number/" target="_blank" rel="noopener">电话号码字母组合</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line"></span><br><span class="line">    const ALPHA = [</span><br><span class="line">        2 =&gt; &apos;abc&apos;,</span><br><span class="line">        3 =&gt; &apos;def&apos;,</span><br><span class="line">        4 =&gt; &apos;ghi&apos;,</span><br><span class="line">        5 =&gt; &apos;jkl&apos;,</span><br><span class="line">        6 =&gt; &apos;mno&apos;,</span><br><span class="line">        7 =&gt; &apos;pqrs&apos;,</span><br><span class="line">        8 =&gt; &apos;tuv&apos;,</span><br><span class="line">        9 =&gt; &apos;wxyz&apos;,</span><br><span class="line">    ];</span><br><span class="line">    private $output = [];</span><br><span class="line">    /**</span><br><span class="line">     * @param String $digits</span><br><span class="line">     * @return String[]</span><br><span class="line">     */</span><br><span class="line">    function letterCombinations($digits) &#123;</span><br><span class="line">        if (strlen($digits) == 0) &#123;</span><br><span class="line">            return [];</span><br><span class="line">        &#125;</span><br><span class="line">        $len = strlen($digits);</span><br><span class="line">        $this-&gt;combine(&quot;&quot;, $digits);</span><br><span class="line">        return $this-&gt;output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function combine($combine, $digits) &#123;</span><br><span class="line">        if (strlen($digits) == 0) &#123;</span><br><span class="line">            array_push($this-&gt;output, $combine);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for($i=0;$i&lt;strlen(self::ALPHA[$digits[0]]);$i++) &#123;</span><br><span class="line">            $letter = self::ALPHA[$digits[0]][$i];</span><br><span class="line">            $this-&gt;combine($combine.$letter, substr($digits, 1));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/27/双指针/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西北玄天一片云">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/27/双指针/" itemprop="url">双指针</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-27T19:23:00+08:00">
                2020-02-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/双指针/" itemprop="url" rel="index">
                    <span itemprop="name">双指针</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><p><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/" target="_blank" rel="noopener">删除排序数组中的重复项</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param Integer[] $nums</span><br><span class="line">     * @return Integer</span><br><span class="line">     */</span><br><span class="line">    function removeDuplicates(&amp;$nums) &#123;</span><br><span class="line">        $length = count($nums);</span><br><span class="line">        $i = 0;</span><br><span class="line">        for($j = 1;$j&lt;$length;$j++) &#123;</span><br><span class="line">            if ($nums[$j] != $nums[$i]) &#123;</span><br><span class="line">                $i++;</span><br><span class="line">                $nums[$i] = $nums[$j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return $i + 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h2><p><a href="https://leetcode-cn.com/problems/remove-nth-node-from-end-of-list/" target="_blank" rel="noopener">删除链表的倒数第N个节点</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Definition for a singly-linked list.</span><br><span class="line"> * class ListNode &#123;</span><br><span class="line"> *     public $val = 0;</span><br><span class="line"> *     public $next = null;</span><br><span class="line"> *     function __construct($val) &#123; $this-&gt;val = $val; &#125;</span><br><span class="line"> * &#125;</span><br><span class="line"> */</span><br><span class="line">class Solution &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param ListNode $head</span><br><span class="line">     * @param Integer $n</span><br><span class="line">     * @return ListNode</span><br><span class="line">     */</span><br><span class="line">    function removeNthFromEnd($head, $n) &#123;</span><br><span class="line">        $slow = $fast = $head;</span><br><span class="line">        while ($n&gt;0) &#123;</span><br><span class="line">            $n--;</span><br><span class="line">            $fast = $fast-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        while($fast != null &amp;&amp; $fast-&gt;next != null) &#123;</span><br><span class="line">            $fast = $fast-&gt;next;</span><br><span class="line">            $slow = $slow-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        if ($slow == $head &amp;&amp; $fast == null) &#123;</span><br><span class="line">            return $head-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        $slow-&gt;next = $slow-&gt;next-&gt;next;</span><br><span class="line">        return $head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="题目三"><a href="#题目三" class="headerlink" title="题目三"></a>题目三</h2><p><a href="https://leetcode-cn.com/problems/3sum/" target="_blank" rel="noopener">三数之和</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param Integer[] $nums</span><br><span class="line">     * @return Integer[][]</span><br><span class="line">     */</span><br><span class="line">    function threeSum($nums) &#123;</span><br><span class="line">        if (count($nums) &lt; 3) &#123;</span><br><span class="line">            return [];</span><br><span class="line">        &#125;</span><br><span class="line">        $res = [];</span><br><span class="line">        sort($nums);</span><br><span class="line">        $length = count($nums);</span><br><span class="line">        </span><br><span class="line">        for ($i = 0; $i &lt; $length-2;$i++) &#123;</span><br><span class="line">            $start = $i+1;</span><br><span class="line">            $end   = $length-1;</span><br><span class="line">            if ($i&gt;0&amp;&amp;$nums[$i]==$nums[$i-1]) &#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            while ($start &lt; $end) &#123;</span><br><span class="line">                if (($nums[$i] + $nums[$start] + $nums[$end]) == 0) &#123;</span><br><span class="line">                    $res[] = [$nums[$i], $nums[$start], $nums[$end]];</span><br><span class="line">                    while($start&lt;$end &amp;&amp; $nums[$start] == $nums[$start+1]) &#123;</span><br><span class="line">                        $start++;</span><br><span class="line">                    &#125;</span><br><span class="line">                    while($start&lt;$end &amp;&amp; $nums[$end] == $nums[$end-1]) &#123;</span><br><span class="line">                        $end--;</span><br><span class="line">                    &#125;</span><br><span class="line">                    $start++;</span><br><span class="line">                    $end--;</span><br><span class="line">                &#125; elseif (($nums[$i] + $nums[$start] + $nums[$end]) &gt; 0) &#123;</span><br><span class="line">                    $end--;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    $start++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        return $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/27/二分查找/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西北玄天一片云">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/27/二分查找/" itemprop="url">二分查找</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-27T19:03:00+08:00">
                2020-02-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/二分查找/" itemprop="url" rel="index">
                    <span itemprop="name">二分查找</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>搞定这三道题，你就搞定了二分查找。</p>
<h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><p><code>给定有序(升序)数组nums，和目标值target，查找target在数组中的任一位置（从0开始），找不到返回-1</code></p>
<p>代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">search</span><span class="params">($nums, $target)</span> </span>&#123;</span><br><span class="line">		 <span class="keyword">if</span> ($nums == <span class="keyword">null</span> || count($nums) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $length = count($nums);</span><br><span class="line">        $start = <span class="number">0</span>;</span><br><span class="line">        $end = $length<span class="number">-1</span>;        </span><br><span class="line">        <span class="keyword">while</span> ($start &lt;= $end) &#123;</span><br><span class="line">            $mid = $start + round(($end-$start)/<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span> ($nums[$mid] == $target) &#123;</span><br><span class="line">                <span class="keyword">return</span> $mid;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ($nums[$mid] &gt; $target) &#123;</span><br><span class="line">            		$end = $mid - <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            		$start = $mid + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h2><p><code>给定有序数组array，和目标值target，查找target在数组中第一个出现的位置（从0开始），找不到返回-1</code><br>代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">search</span><span class="params">($nums, $target)</span> </span>&#123;</span><br><span class="line">		 <span class="keyword">if</span> ($nums == <span class="keyword">null</span> || count($nums) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $length = count($nums);</span><br><span class="line">        $start = <span class="number">0</span>;</span><br><span class="line">        $end = $length<span class="number">-1</span>;        </span><br><span class="line">        <span class="keyword">while</span> ($start &lt;= $end) &#123;</span><br><span class="line">            $mid = $start + round(($end-$start)/<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">if</span> ($mid == <span class="number">0</span> &amp;&amp; $nums[$mid] == $target) &#123;</span><br><span class="line">            		<span class="keyword">return</span> $mid;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ($nums[$mid] == $target &amp;&amp; $nums[$mid<span class="number">-1</span>] != $target) &#123;</span><br><span class="line">                <span class="keyword">return</span> $mid;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ($nums[$mid] &gt;= $target) &#123;</span><br><span class="line">            		$end = $mid - <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            		$start = $mid + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="题目三"><a href="#题目三" class="headerlink" title="题目三"></a>题目三</h2><p><a href="https://leetcode-cn.com/problems/search-in-rotated-sorted-array/" target="_blank" rel="noopener">搜索旋转排序数组</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">假设按照升序排序的数组在预先未知的某个点上进行了旋转。</span><br><span class="line"></span><br><span class="line">( 例如，数组 [0,1,2,4,5,6,7] 可能变为 [4,5,6,7,0,1,2] )。</span><br><span class="line"></span><br><span class="line">搜索一个给定的目标值，如果数组中存在这个目标值，则返回它的索引，否则返回 -1 。</span><br><span class="line"></span><br><span class="line">你可以假设数组中不存在重复的元素。</span><br><span class="line"></span><br><span class="line">你的算法时间复杂度必须是 O(log n) 级别。</span><br><span class="line"></span><br><span class="line">来源：力扣（LeetCode）</span><br><span class="line">链接：https://leetcode-cn.com/problems/search-in-rotated-sorted-array</span><br><span class="line">著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Solution &#123;</span><br><span class="line">    /**</span><br><span class="line">     * @param Integer[] $nums</span><br><span class="line">     * @param Integer $target</span><br><span class="line">     * @return Integer</span><br><span class="line">     */</span><br><span class="line">    function search($nums, $target) &#123;</span><br><span class="line">        if ($nums == null || count($nums) == 0) &#123;</span><br><span class="line">            return -1;</span><br><span class="line">        &#125;</span><br><span class="line">        $length = count($nums);</span><br><span class="line">        $start = 0;</span><br><span class="line">        $end = $length-1;        </span><br><span class="line">        while ($start &lt;= $end) &#123;</span><br><span class="line">            $mid = $start + round(($end-$start)/2);</span><br><span class="line">            if ($nums[$end] == $target) &#123;</span><br><span class="line">                return $end;</span><br><span class="line">            &#125;</span><br><span class="line">            if ($nums[$start] == $target) &#123;</span><br><span class="line">                return $start;</span><br><span class="line">            &#125;</span><br><span class="line">            if ($nums[$mid] == $target) &#123;</span><br><span class="line">                return $mid;</span><br><span class="line">            &#125;</span><br><span class="line">            if ($nums[$mid] &gt; $nums[$end]) &#123;</span><br><span class="line">                if ($nums[$mid] &gt; $target) &#123;</span><br><span class="line">                    if ($target &gt; $nums[$end]) &#123;</span><br><span class="line">                        $end = $mid - 1;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        $start = $mid + 1;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    $start = $mid + 1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">               if ($nums[$mid] &gt; $target) &#123;</span><br><span class="line">                   $end = $mid - 1;</span><br><span class="line">               &#125; else &#123;</span><br><span class="line">                   if ($target &lt; $nums[$end]) &#123;</span><br><span class="line">                       $start = $mid + 1;</span><br><span class="line">                   &#125; else &#123;</span><br><span class="line">                       $end = $mid - 1;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/27/红黑树与B+树的对比/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西北玄天一片云">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/27/红黑树与B+树的对比/" itemprop="url">红黑树与B+树的对比</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-27T18:13:00+08:00">
                2020-02-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据结构/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>红黑树和B+树是两种比较重要的高级数据结构。接下来我们来对二者做一个对比分析。</p>
<h2 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">红黑树的五个性质：</span><br><span class="line">一般的，红黑树(一棵自平衡的排序二叉树)，满足以下性质，即只有满足以下性质的树，我们才称之为红黑树：</span><br><span class="line">1）每个结点要么是红的，要么是黑的。</span><br><span class="line">2）根结点是黑的。</span><br><span class="line">3）每个叶结点，即空结点（NIL）是黑的。</span><br><span class="line">4）如果一个结点是红的，那么它的俩个儿子都是黑的。</span><br><span class="line">5）对每个结点，从该结点到其子孙结点的所有路径上包含相同数目的黑结点。</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/27/红黑树与B+树的对比/redblacktree.png" alt></p>
<h2 id="B-树"><a href="#B-树" class="headerlink" title="B+树"></a>B+树</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">一个m阶的B+树具有如下几个特征：</span><br><span class="line"></span><br><span class="line">1.有k个子树的中间节点包含有k个元素（B树中是k-1个元素），每个元素不保存数据，只用来索引，所有数据都保存在叶子节点。</span><br><span class="line"></span><br><span class="line">2.所有的叶子结点中包含了全部元素的信息，及指向含这些元素记录的指针，且叶子结点本身依关键字的大小自小而大顺序链接。</span><br><span class="line"></span><br><span class="line">3.所有的中间节点元素都同时存在于子节点，在子节点元素中是最大（或最小）元素。</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/27/红黑树与B+树的对比/B+tree.png" alt></p>
<h2 id="B树"><a href="#B树" class="headerlink" title="B树"></a>B树</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">一个m阶的B树具有如下几个特征：</span><br><span class="line"></span><br><span class="line">1.根结点至少有两个子女。</span><br><span class="line"></span><br><span class="line">2.每个中间节点都包含k-1个元素和k个孩子，其中 m/2 &lt;= k &lt;= m</span><br><span class="line"></span><br><span class="line">3.每一个叶子节点都包含k-1个元素，其中 m/2 &lt;= k &lt;= m</span><br><span class="line"></span><br><span class="line">4.所有的叶子结点都位于同一层。</span><br><span class="line"></span><br><span class="line">5.每个节点中的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的值域分划。</span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/27/红黑树与B+树的对比/Btree.png" alt></p>
<h2 id="对比分析"><a href="#对比分析" class="headerlink" title="对比分析"></a>对比分析</h2><table>
<thead>
<tr>
<th>数据结构</th>
<th>查询性能</th>
<th>插入性能</th>
<th>删除性能</th>
<th>优点</th>
<th>缺点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>红黑树</td>
<td>O(logN)</td>
<td>O(logN)</td>
<td>O(logN)</td>
<td>增删查性能高，相对平衡二叉树简单</td>
<td>树的深度相对B树高</td>
<td>用在内部排序，即全放在内存中的，如：STC的map；hashtable冲突到一定程度链表改为红黑树；epoll监听句柄</td>
</tr>
<tr>
<td>平衡二叉树</td>
<td>O(logN)</td>
<td>O(logN)</td>
<td>O(logN)</td>
<td>增删查性能高</td>
<td>维护平衡的旋转逻辑复杂</td>
<td>暂无</td>
</tr>
<tr>
<td>B+树</td>
<td>与树高有关，不超过节点数<img src="/2020/02/27/红黑树与B+树的对比/b-treefind.png" alt></td>
<td>同查询</td>
<td>同查询</td>
<td>完美支持磁盘预读</td>
<td>性能相比红黑树差</td>
<td>数据库索引</td>
</tr>
<tr>
<td>B-树</td>
<td>与树高有关，不超过节点数<img src="/2020/02/27/红黑树与B+树的对比/b-treefind.png" alt></td>
<td>同查询</td>
<td>同查询</td>
<td>支持磁盘预读</td>
<td>节点存储数据，相比B+树占用空间大</td>
<td>数据库索引</td>
</tr>
</tbody></table>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="https://blog.csdn.net/zuochao_2013/article/details/80562092" target="_blank" rel="noopener">红黑树的定义与运用场景</a></li>
<li><a href="https://www.cnblogs.com/doit8791/p/8757125.html" target="_blank" rel="noopener">平衡二叉树、B树、B+树、B*树、LSM树简介</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/27/PHP中数组的实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西北玄天一片云">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/27/PHP中数组的实现/" itemprop="url">PHP中数组的实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-27T10:47:00+08:00">
                2020-02-27
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/PHP数组/" itemprop="url" rel="index">
                    <span itemprop="name">PHP数组</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><img src="/2020/02/27/PHP中数组的实现/phpbest.jpg" alt></p>
<p>PHPer们应该都知道，PHP中无所不能的数组是通过Hashtable+双向链表的形式实现的。</p>
<p>那hash和链表到底是怎么一种组织方式呢？下面我们开始细细研究。</p>
<h2 id="hashtable实现及组织方式"><a href="#hashtable实现及组织方式" class="headerlink" title="hashtable实现及组织方式"></a>hashtable实现及组织方式</h2><h3 id="php5版本"><a href="#php5版本" class="headerlink" title="php5版本"></a>php5版本</h3><p><img src="/2020/02/27/PHP中数组的实现/php5hashtable.png" alt></p>
<h3 id="php7版本"><a href="#php7版本" class="headerlink" title="php7版本"></a>php7版本</h3><p><code>Zend/zend_types.h</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">struct _zend_array &#123;</span><br><span class="line">	zend_refcounted_h gc;</span><br><span class="line">	union &#123;</span><br><span class="line">		struct &#123;</span><br><span class="line">			ZEND_ENDIAN_LOHI_4(</span><br><span class="line">				zend_uchar    flags,</span><br><span class="line">				zend_uchar    _unused,</span><br><span class="line">				zend_uchar    nIteratorsCount,</span><br><span class="line">				zend_uchar    _unused2)</span><br><span class="line">		&#125; v;</span><br><span class="line">		uint32_t flags;</span><br><span class="line">	&#125; u;</span><br><span class="line">	uint32_t          nTableMask;</span><br><span class="line">	Bucket           *arData;</span><br><span class="line">	uint32_t          nNumUsed;</span><br><span class="line">	uint32_t          nNumOfElements;</span><br><span class="line">	uint32_t          nTableSize;</span><br><span class="line">	uint32_t          nInternalPointer;</span><br><span class="line">	zend_long         nNextFreeElement;</span><br><span class="line">	dtor_func_t       pDestructor;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * HashTable Data Layout</span><br><span class="line"> * =====================</span><br><span class="line"> *</span><br><span class="line"> *                 +=============================+</span><br><span class="line"> *                 | HT_HASH(ht, ht-&gt;nTableMask) |</span><br><span class="line"> *                 | ...                         |</span><br><span class="line"> *                 | HT_HASH(ht, -1)             |</span><br><span class="line"> *                 +-----------------------------+</span><br><span class="line"> * ht-&gt;arData ---&gt; | Bucket[0]                   |</span><br><span class="line"> *                 | ...                         |</span><br><span class="line"> *                 | Bucket[ht-&gt;nTableSize-1]    |</span><br><span class="line"> *                 +=============================+</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/02/27/PHP中数组的实现/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/26/php如何实现弱类型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="西北玄天一片云">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/02/26/php如何实现弱类型/" itemprop="url">php如何实现弱类型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-26T18:26:00+08:00">
                2020-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/PHP变量/" itemprop="url" rel="index">
                    <span itemprop="name">PHP变量</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="/2020/02/26/php如何实现弱类型/bestlanguage.jpg" alt></p>
<p>PHPer都知道，PHP是一门弱类型语言。所谓弱类型是指，变量在声明时不需要指明存储的数据类型。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>   </span><br><span class="line">  $var = <span class="number">1</span>; <span class="comment">//int   </span></span><br><span class="line">  $var = <span class="string">"laruence"</span>; <span class="comment">//string   </span></span><br><span class="line">  $var = <span class="number">1.0002</span>; <span class="comment">//float   </span></span><br><span class="line">  $var = <span class="keyword">array</span>(); <span class="comment">// array   </span></span><br><span class="line">  $var = <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">'error'</span>); <span class="comment">//object;</span></span><br></pre></td></tr></table></figure>

<p>那么PHP是如何实现这种弱类型变量的呢？</p>
<h2 id="PHP变量的定义"><a href="#PHP变量的定义" class="headerlink" title="PHP变量的定义"></a>PHP变量的定义</h2><p><font color="red">注：zval在PHP7中有所优化</font></p>
<p>在PHP中，所有的变量都是用一个结构-zval来保存的， 在Zend/zend.h中我们可以看到zval的定义：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">zval_struct</span> &#123;</span>   </span><br><span class="line">     zvalue_value value;   </span><br><span class="line">     zend_uint refcount;   </span><br><span class="line">     zend_uchar type;   </span><br><span class="line">     zend_uchar is_ref;   </span><br><span class="line">&#125; zval;</span><br></pre></td></tr></table></figure>

<h2 id="问题一、Zend引擎是如何用C实现这种弱类型的呢？"><a href="#问题一、Zend引擎是如何用C实现这种弱类型的呢？" class="headerlink" title="问题一、Zend引擎是如何用C实现这种弱类型的呢？"></a>问题一、Zend引擎是如何用C实现这种弱类型的呢？</h2><p>其中zvalue_value是真正保存数据的关键部分，现在到了揭晓谜底的时候了，PHP是如何在ZE的基础上实现弱类型的呢？ 因为zvalue_value是个联合体(union)。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">union</span> _zvalue_value &#123;   </span><br><span class="line">     lval; </span><br><span class="line">     dval;   </span><br><span class="line">     truct &#123;   </span><br><span class="line">         *val;   </span><br><span class="line">         len;   </span><br><span class="line">     &#125; str;   </span><br><span class="line">     HashTable *ht;   </span><br><span class="line">     zend_object_value obj;   </span><br><span class="line">&#125; zvalue_value;</span><br></pre></td></tr></table></figure>

<h2 id="问题二、Zend引擎是如何判别、存储PHP中的多种数据类型的呢？"><a href="#问题二、Zend引擎是如何判别、存储PHP中的多种数据类型的呢？" class="headerlink" title="问题二、Zend引擎是如何判别、存储PHP中的多种数据类型的呢？"></a>问题二、Zend引擎是如何判别、存储PHP中的多种数据类型的呢？</h2><p>_zval_struct.type中存储着一个变量的真正类型，根据type来选择如何获取zvalue_value的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(Zend/zend.h)</span><br><span class="line">#define IS_NULL		0</span><br><span class="line">#define IS_LONG		1</span><br><span class="line">#define IS_DOUBLE	2</span><br><span class="line">#define IS_BOOL		3</span><br><span class="line">#define IS_ARRAY	4</span><br><span class="line">#define IS_OBJECT	5</span><br><span class="line">#define IS_STRING	6</span><br><span class="line">#define IS_RESOURCE	7</span><br><span class="line">#define IS_CONSTANT	8</span><br><span class="line">#define IS_CONSTANT_ARRAY	9</span><br></pre></td></tr></table></figure>

<p>来看一个简单的例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	$a = <span class="number">1</span>; <span class="comment">//此时zval.type = IS_LONG,那么zval.value就去取lval.</span></span><br><span class="line">	$a = <span class="keyword">array</span>(); <span class="comment">//此时zval.type = IS_ARRAY,那么zval.value就去取ht</span></span><br></pre></td></tr></table></figure>

<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://blog.csdn.net/a600423444/article/details/7017878" target="_blank" rel="noopener">PHP源码分析-弱类型变量实现</a></li>
<li><a href="https://www.laruence.com/2018/04/08/3170.html" target="_blank" rel="noopener">深入理解PHP7内核之zval</a></li>
<li><a href="https://wangheng.org/html/weakly_typed_implement.html" target="_blank" rel="noopener">笔记</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpeg" alt="John Doe">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">57</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

	  
		<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
		<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
		<div class="widget-wrap">
		    <h3 class="widget-title">Tag Cloud</h3>
		    <div id="myCanvasContainer" class="widget tagcloud">
		        <canvas width="250" height="250" id="resCanvas" style="width=100%">
		            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/499/">499</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/502/">502</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/504/">504</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/B-树/">B+树</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Binlog/">Binlog</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Binlog与Redolog一致性/">Binlog与Redolog一致性</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/COW/">COW</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cache/">Cache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/InnoDB/">InnoDB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL查询/">MySQL查询</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Next/">Next</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis数据结构/">Redis数据结构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redo-log/">Redo log</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOA架构/">SOA架构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UDP/">UDP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WAL/">WAL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/copy-on-write/">copy on write</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fork/">fork</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http1-1/">http1.1</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http1-2/">http1.2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http协议/">http协议</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/keepalive/">keepalive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php源码/">php源码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/一致性/">一致性</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/七层协议栈/">七层协议栈</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/二分查找/">二分查找</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式锁/">分布式锁</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分库/">分库</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分表/">分表</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分表扩容/">分表扩容</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客搭建/">博客搭建</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/双指针/">双指针</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/回溯算法/">回溯算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/容量预估/">容量预估</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/弱类型/">弱类型</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微服务架构/">微服务架构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/持久化/">持久化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数组源码/">数组源码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/查询过程/">查询过程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/短连接/">短连接</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/系统设计/">系统设计</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/红黑树/">红黑树</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络协议/">网络协议</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/负载均衡/">负载均衡</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/长连接/">长连接</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面试算法/">面试算法</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高可用/">高可用</a><span class="tag-list-count">1</span></li></ul>
		        </canvas>
		    </div>
		</div>
	   

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user">本站访问数</i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye">本站总访问量</i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  














  





  

  

  

  
  

  

  

  

</body>
</html>
